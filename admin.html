<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - investaì˜ íˆ¬ì ì •ë³´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <style>
        .active-tab {
            background-color: #3b82f6;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼</h2>
            <p class="text-gray-600 mb-4">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <form id="password-form" onsubmit="checkPassword(event)" class="space-y-4">
                <div>
                    <input 
                        type="password" 
                        id="password-input" 
                        required
                        autofocus
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                    >
                </div>
                <div id="password-error" class="text-red-600 text-sm hidden"></div>
                <button 
                    type="submit"
                    class="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                >
                    í™•ì¸
                </button>
            </form>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í›„ í‘œì‹œ) -->
    <div id="main-content" class="hidden">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-2xl font-bold text-blue-600">ê´€ë¦¬ì í˜ì´ì§€</h1>
                <div class="flex items-center gap-4">
                    <button 
                        onclick="goToWritePage()"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                    >
                        ê¸€ì“°ê¸°
                    </button>
                    <a 
                        href="index.html" 
                        class="text-gray-700 hover:text-blue-600 transition"
                    >
                        í™ˆìœ¼ë¡œ
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="mb-8">
            <div class="flex gap-2 border-b">
                <button 
                    onclick="switchTab('posts')" 
                    id="tab-posts"
                    class="px-6 py-3 font-medium text-gray-700 hover:text-blue-600 transition active-tab"
                >
                    ê²Œì‹œê¸€ ê´€ë¦¬
                </button>
                <button 
                    onclick="switchTab('stats')" 
                    id="tab-stats"
                    class="px-6 py-3 font-medium text-gray-700 hover:text-blue-600 transition"
                >
                    í†µê³„ ê´€ë¦¬
                </button>
            </div>
        </div>

        <!-- ê²Œì‹œê¸€ ê´€ë¦¬ íƒ­ -->
        <div id="content-posts" class="tab-content active">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">ê²Œì‹œê¸€ ê´€ë¦¬</h2>
                    <div class="flex gap-2">
                        <button 
                            onclick="exportPosts()" 
                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                            title="ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ"
                        >
                            ğŸ“¥ ë°ì´í„° ë°±ì—…
                        </button>
                        <label 
                            for="import-file"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition cursor-pointer"
                            title="JSON íŒŒì¼ì—ì„œ ê²Œì‹œê¸€ ë°ì´í„° ë³µì›"
                        >
                            ğŸ“¤ ë°ì´í„° ë³µì›
                        </label>
                        <input 
                            type="file" 
                            id="import-file" 
                            accept=".json" 
                            class="hidden"
                            onchange="importPosts(event)"
                        >
                        <button 
                            onclick="syncFromGitHub()" 
                            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
                            title="GitHubì—ì„œ ìµœì‹  ê²Œì‹œê¸€ ë°ì´í„° ë™ê¸°í™”"
                        >
                            ğŸ”„ GitHub ë™ê¸°í™”
                        </button>
                        <button 
                            onclick="loadPosts()" 
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                        >
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>
                
                <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <p class="text-sm text-red-800 font-semibold mb-2">
                        âš ï¸ ì¤‘ìš”: ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œë„ ê²Œì‹œê¸€ì„ ë³´ë ¤ë©´ GitHubì— ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤!
                    </p>
                    <p class="text-sm text-red-700">
                        <strong>ë°©ë²•:</strong><br>
                        1. "ğŸ“¥ ë°ì´í„° ë°±ì—…" ë²„íŠ¼ í´ë¦­ â†’ posts.json íŒŒì¼ ë‹¤ìš´ë¡œë“œ<br>
                        2. <a href="https://github.com/freerahn/stock_blog/blob/main/public/posts.json" target="_blank" class="underline">GitHubì˜ public/posts.json íŒŒì¼</a> í´ë¦­<br>
                        3. ì—°í•„ ì•„ì´ì½˜(í¸ì§‘) í´ë¦­ â†’ ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ ë‚´ìš© ë¶™ì—¬ë„£ê¸°<br>
                        4. "Commit changes" í´ë¦­<br>
                        5. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ â†’ ìë™ìœ¼ë¡œ ë™ê¸°í™”ë¨!
                    </p>
                </div>
                
                <div id="import-message" class="mb-4 hidden"></div>
                
                <div id="posts-list" class="space-y-4">
                    <!-- ê²Œì‹œê¸€ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- í†µê³„ ê´€ë¦¬ íƒ­ -->
        <div id="content-stats" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ì¼ìë³„ ë°©ë¬¸ì -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">ì¼ìë³„ ë°©ë¬¸ì</h2>
                    <canvas id="visitorChart" width="400" height="200"></canvas>
                </div>
                
                <!-- ê²Œì‹œê¸€ë³„ ì¡°íšŒìˆ˜ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">ê²Œì‹œê¸€ë³„ ì¡°íšŒìˆ˜</h2>
                    <canvas id="viewsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- ë©”ì¸ ì»¨í…ì¸  ë -->

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full mx-4 max-h-[95vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">ê²Œì‹œê¸€ ìˆ˜ì •</h3>
                <button 
                    onclick="closeEditModal()" 
                    class="text-gray-500 hover:text-gray-700 text-2xl"
                >
                    Ã—
                </button>
            </div>
            
            <form id="edit-form" onsubmit="saveEditedPost(event)" class="space-y-6">
                <input type="hidden" id="edit-post-id">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª© *</label>
                    <input 
                        type="text" 
                        id="edit-title" 
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    >
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¢…ëª©ëª…</label>
                        <input 
                            type="text" 
                            id="edit-stockName" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="ì˜ˆ: ì‚¼ì„±ì „ì"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¢…ëª©ì½”ë“œ</label>
                        <input 
                            type="text" 
                            id="edit-stockSymbol" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="ì˜ˆ: 005930"
                        >
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ìš”ì•½ (SEOìš©)</label>
                    <textarea 
                        id="edit-excerpt" 
                        rows="3"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ê¸€ ìš”ì•½ì„ ì…ë ¥í•˜ì„¸ìš”"
                    ></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë³¸ë¬¸ *</label>
                    <div id="edit-contentEditor" style="height: 400px;" class="mb-2"></div>
                    <textarea 
                        id="edit-content" 
                        required
                        class="hidden"
                    ></textarea>
                    <p class="text-xs text-gray-500">ì„œì‹, ë§í¬, ì´ë¯¸ì§€ ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">íƒœê·¸ (SEOìš©)</label>
                    <div class="flex gap-2 mb-2">
                        <input 
                            type="text" 
                            id="edit-tagInput" 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”"
                        >
                        <button 
                            type="button" 
                            id="edit-addTagBtn"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                        >
                            ì¶”ê°€
                        </button>
                    </div>
                    <div id="edit-tagsContainer" class="flex flex-wrap gap-2"></div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¯¸ì§€ URL</label>
                    <div class="flex gap-2 mb-2">
                        <input 
                            type="url" 
                            id="edit-imageInput" 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”"
                        >
                        <button 
                            type="button" 
                            id="edit-addImageBtn"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                        >
                            ì¶”ê°€
                        </button>
                    </div>
                    <div id="edit-imagesContainer" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4"></div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì„±ì</label>
                    <input 
                        type="text" 
                        id="edit-author" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ì‘ì„±ì ì´ë¦„"
                    >
                </div>
                
                <div class="flex gap-4">
                    <button 
                        type="submit"
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                    >
                        ì €ì¥
                    </button>
                    <button 
                        type="button"
                        onclick="closeEditModal()"
                        class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                    >
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'stock_blog_posts';
        const STATS_KEY = 'stock_blog_stats';
        
        // ê²Œì‹œê¸€ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function getAllPosts() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (!stored) return [];
                return JSON.parse(stored);
            } catch (error) {
                console.error('Error loading posts:', error);
                return [];
            }
        }
        
        function savePost(post) {
            const posts = getAllPosts();
            const existingIndex = posts.findIndex(p => p.id === post.id);
            
            if (existingIndex >= 0) {
                posts[existingIndex] = post;
            } else {
                posts.push(post);
            }
            
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
                
                // ì‚¬ì´íŠ¸ë§µ ìë™ ì—…ë°ì´íŠ¸
                updateSitemap(posts);
                
                return true;
            } catch (error) {
                console.error('Error saving post:', error);
                return false;
            }
        }
        
        function deletePost(id) {
            const posts = getAllPosts();
            const filteredPosts = posts.filter(post => post.id !== id);
            
            if (filteredPosts.length < posts.length) {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(filteredPosts));
                    
                    // ì‚¬ì´íŠ¸ë§µ ìë™ ì—…ë°ì´íŠ¸
                    updateSitemap(filteredPosts);
                    
                    return true;
                } catch (error) {
                    console.error('Error deleting post:', error);
                    return false;
                }
            }
            return false;
        }
        
        // ì‚¬ì´íŠ¸ë§µ ìƒì„± ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function generateSitemap(posts) {
            const baseUrl = 'https://freerahn.github.io/stock_blog';
            const today = new Date().toISOString().split('T')[0];
            
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';
            
            // í™ˆí˜ì´ì§€
            xml += '  <url>\n';
            xml += `    <loc>${baseUrl}/</loc>\n`;
            xml += `    <lastmod>${today}</lastmod>\n`;
            xml += '    <changefreq>daily</changefreq>\n';
            xml += '    <priority>1.0</priority>\n';
            xml += '  </url>\n';
            
            // ê²Œì‹œê¸€ ì‘ì„± í˜ì´ì§€
            xml += '  <url>\n';
            xml += `    <loc>${baseUrl}/admin/write</loc>\n`;
            xml += `    <lastmod>${today}</lastmod>\n`;
            xml += '    <changefreq>monthly</changefreq>\n';
            xml += '    <priority>0.5</priority>\n';
            xml += '  </url>\n';
            
            // ê° ê²Œì‹œê¸€ ì¶”ê°€
            posts.forEach(post => {
                const lastModified = post.updatedAt 
                    ? new Date(post.updatedAt).toISOString().split('T')[0]
                    : new Date(post.createdAt).toISOString().split('T')[0];
                
                xml += '  <url>\n';
                xml += `    <loc>${baseUrl}/posts/${post.id}</loc>\n`;
                xml += `    <lastmod>${lastModified}</lastmod>\n`;
                xml += '    <changefreq>weekly</changefreq>\n';
                xml += '    <priority>0.8</priority>\n';
                xml += '  </url>\n';
            });
            
            xml += '</urlset>';
            
            return xml;
        }
        
        function updateSitemap(posts) {
            try {
                const sitemapXml = generateSitemap(posts);
                localStorage.setItem('stock_blog_sitemap', sitemapXml);
                console.log('âœ… ì‚¬ì´íŠ¸ë§µì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì‚¬ì´íŠ¸ë§µ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }
        
        // GitHubì—ì„œ ê²Œì‹œê¸€ ë°ì´í„° ë™ê¸°í™”
        async function syncFromGitHub() {
            const messageDiv = document.getElementById('import-message');
            messageDiv.className = 'mb-4 p-4 bg-blue-100 border border-blue-400 text-blue-700 rounded-lg';
            messageDiv.textContent = 'ğŸ”„ GitHubì—ì„œ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ëŠ” ì¤‘...';
            messageDiv.classList.remove('hidden');
            
            try {
                const GITHUB_POSTS_URL = 'https://raw.githubusercontent.com/freerahn/stock_blog/main/public/posts.json';
                const response = await fetch(GITHUB_POSTS_URL, {
                    cache: 'no-cache',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const githubPosts = await response.json();
                    
                    if (Array.isArray(githubPosts) && githubPosts.length > 0) {
                        const localPosts = getAllPosts();
                        
                        // GitHub ë°ì´í„°ì™€ ë¡œì»¬ ë°ì´í„° ë³‘í•©
                        const mergedPosts = [...localPosts];
                        githubPosts.forEach(githubPost => {
                            const existingIndex = mergedPosts.findIndex(p => p.id === githubPost.id);
                            if (existingIndex >= 0) {
                                // ë¡œì»¬ì— ìˆìœ¼ë©´ ë” ìµœì‹  ë°ì´í„° ì‚¬ìš© (updatedAt ë¹„êµ)
                                const localPost = mergedPosts[existingIndex];
                                const localDate = new Date(localPost.updatedAt || localPost.createdAt);
                                const githubDate = new Date(githubPost.updatedAt || githubPost.createdAt);
                                
                                if (githubDate > localDate) {
                                    mergedPosts[existingIndex] = githubPost;
                                }
                            } else {
                                // ë¡œì»¬ì— ì—†ìœ¼ë©´ GitHub ë°ì´í„° ì¶”ê°€
                                mergedPosts.push(githubPost);
                            }
                        });
                        
                        // ë³‘í•©ëœ ë°ì´í„° ì €ì¥
                        if (mergedPosts.length !== localPosts.length || 
                            JSON.stringify(mergedPosts) !== JSON.stringify(localPosts)) {
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(mergedPosts));
                            localStorage.setItem('stock_blog_last_sync', Date.now().toString());
                            
                            // ì‚¬ì´íŠ¸ë§µ ì—…ë°ì´íŠ¸
                            updateSitemap(mergedPosts);
                            
                            // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                            loadPosts();
                            
                            messageDiv.className = 'mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg';
                            messageDiv.textContent = `âœ… GitHubì—ì„œ ${githubPosts.length}ê°œì˜ ê²Œì‹œê¸€ì„ ë™ê¸°í™”í–ˆìŠµë‹ˆë‹¤. (ì´ ${mergedPosts.length}ê°œ)`;
                        } else {
                            messageDiv.className = 'mb-4 p-4 bg-blue-100 border border-blue-400 text-blue-700 rounded-lg';
                            messageDiv.textContent = 'â„¹ï¸ ì´ë¯¸ ìµœì‹  ë°ì´í„°ì…ë‹ˆë‹¤.';
                        }
                    } else {
                        messageDiv.className = 'mb-4 p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded-lg';
                        messageDiv.textContent = 'âš ï¸ GitHubì— ì €ì¥ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
                    }
                } else {
                    throw new Error('GitHubì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
                messageDiv.className = 'mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                messageDiv.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + error.message + '\n\nğŸ’¡ GitHubì— public/posts.json íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
            }
            
            // 5ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }
        
        // í†µê³„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function getStats() {
            try {
                const stored = localStorage.getItem(STATS_KEY);
                if (!stored) return { visitors: {}, views: {} };
                return JSON.parse(stored);
            } catch (error) {
                console.error('Error loading stats:', error);
                return { visitors: {}, views: {} };
            }
        }
        
        function saveStats(stats) {
            try {
                localStorage.setItem(STATS_KEY, JSON.stringify(stats));
                return true;
            } catch (error) {
                console.error('Error saving stats:', error);
                return false;
            }
        }
        
        function recordVisitor() {
            const today = new Date().toISOString().split('T')[0];
            const stats = getStats();
            
            if (!stats.visitors[today]) {
                stats.visitors[today] = 0;
            }
            stats.visitors[today]++;
            
            saveStats(stats);
        }
        
        function recordView(postId) {
            const stats = getStats();
            
            if (!stats.views[postId]) {
                stats.views[postId] = 0;
            }
            stats.views[postId]++;
            
            saveStats(stats);
        }
        
        // íƒ­ ì „í™˜
        function switchTab(tab) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('active-tab');
            });
            document.getElementById(`tab-${tab}`).classList.add('active-tab');
            
            // ì»¨í…ì¸  í‘œì‹œ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`content-${tab}`).classList.add('active');
            
            // í†µê³„ íƒ­ìœ¼ë¡œ ì´ë™ ì‹œ ì°¨íŠ¸ ë¡œë“œ
            if (tab === 'stats') {
                loadStats();
            }
        }
        
        // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        function loadPosts() {
            const posts = getAllPosts();
            const postsList = document.getElementById('posts-list');
            
            if (posts.length === 0) {
                postsList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <p class="text-lg">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <a href="#" onclick="goToWritePage(); return false;" class="text-blue-600 hover:underline mt-2 inline-block">ì²« ê¸€ ì‘ì„±í•˜ê¸°</a>
                    </div>
                `;
                return;
            }
            
            // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedPosts = posts.sort((a, b) => 
                new Date(b.createdAt || b.updatedAt) - new Date(a.createdAt || a.updatedAt)
            );
            
            postsList.innerHTML = sortedPosts.map(post => {
                const createdDate = new Date(post.createdAt || post.updatedAt);
                const formattedDate = createdDate.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const stats = getStats();
                const viewCount = stats.views[post.id] || 0;
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900 mb-1">${escapeHtml(post.title)}</h3>
                                <p class="text-sm text-gray-600 mb-2">${escapeHtml(post.excerpt || post.content.substring(0, 100) + '...')}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>ì‘ì„±ì¼: ${formattedDate}</span>
                                    <span>ì¡°íšŒìˆ˜: ${viewCount}</span>
                                    ${post.stockName ? `<span>ì¢…ëª©: ${escapeHtml(post.stockName)}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button 
                                    onclick="editPost('${post.id}')"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm"
                                >
                                    ìˆ˜ì •
                                </button>
                                <button 
                                    onclick="confirmDelete('${post.id}', '${escapeHtml(post.title)}')"
                                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm"
                                >
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ê²Œì‹œê¸€ ë°ì´í„° ë°±ì—… (ë‚´ë³´ë‚´ê¸°)
        function exportPosts() {
            try {
                const posts = getAllPosts();
                const stats = getStats();
                
                // ë°±ì—… ë°ì´í„° ìƒì„±
                const backupData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    posts: posts,
                    stats: stats
                };
                
                // JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `stock_blog_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert(`âœ… ${posts.length}ê°œì˜ ê²Œì‹œê¸€ì´ ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ë°±ì—… ì‹¤íŒ¨:', error);
                alert('âŒ ë°±ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²Œì‹œê¸€ ë°ì´í„° ë³µì› (ê°€ì ¸ì˜¤ê¸°)
        function importPosts(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // ë°ì´í„° ê²€ì¦
                    if (!backupData.posts || !Array.isArray(backupData.posts)) {
                        throw new Error('ì˜ëª»ëœ ë°±ì—… íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }
                    
                    // ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©í• ì§€ ë®ì–´ì“¸ì§€ í™•ì¸
                    const existingPosts = getAllPosts();
                    let message = '';
                    if (existingPosts.length > 0) {
                        const merge = confirm(
                            `ê¸°ì¡´ ê²Œì‹œê¸€ ${existingPosts.length}ê°œê°€ ìˆìŠµë‹ˆë‹¤.\n\n` +
                            `[í™•ì¸] = ê¸°ì¡´ ê²Œì‹œê¸€ê³¼ ë³‘í•© (ì¤‘ë³µ IDëŠ” ìƒˆ ë°ì´í„°ë¡œ ë®ì–´ì”€)\n` +
                            `[ì·¨ì†Œ] = ê¸°ì¡´ ê²Œì‹œê¸€ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆ ë°ì´í„°ë¡œ êµì²´`
                        );
                        
                        if (merge) {
                            // ë³‘í•©: ê¸°ì¡´ ê²Œì‹œê¸€ê³¼ ìƒˆ ê²Œì‹œê¸€ì„ í•©ì¹˜ë˜, ì¤‘ë³µ IDëŠ” ìƒˆ ë°ì´í„°ë¡œ ë®ì–´ì“°ê¸°
                            const mergedPosts = [...existingPosts];
                            backupData.posts.forEach(newPost => {
                                const existingIndex = mergedPosts.findIndex(p => p.id === newPost.id);
                                if (existingIndex >= 0) {
                                    mergedPosts[existingIndex] = newPost;
                                } else {
                                    mergedPosts.push(newPost);
                                }
                            });
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(mergedPosts));
                            message = `âœ… ${backupData.posts.length}ê°œì˜ ê²Œì‹œê¸€ì´ ë³‘í•©ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ${mergedPosts.length}ê°œ)`;
                        } else {
                            // êµì²´: ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆ ë°ì´í„°ë¡œ êµì²´
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(backupData.posts));
                            message = `âœ… ${backupData.posts.length}ê°œì˜ ê²Œì‹œê¸€ë¡œ êµì²´ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                        }
                    } else {
                        // ê¸°ì¡´ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì €ì¥
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(backupData.posts));
                        message = `âœ… ${backupData.posts.length}ê°œì˜ ê²Œì‹œê¸€ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    }
                    
                    // í†µê³„ ë°ì´í„°ë„ ë³µì› (ìˆëŠ” ê²½ìš°)
                    if (backupData.stats) {
                        try {
                            localStorage.setItem(STATS_KEY, JSON.stringify(backupData.stats));
                        } catch (error) {
                            console.warn('í†µê³„ ë°ì´í„° ë³µì› ì‹¤íŒ¨:', error);
                        }
                    }
                    
                    // ì‚¬ì´íŠ¸ë§µ ì—…ë°ì´íŠ¸
                    const allPosts = getAllPosts();
                    updateSitemap(allPosts);
                    
                    // ë©”ì‹œì§€ í‘œì‹œ
                    const messageDiv = document.getElementById('import-message');
                    messageDiv.className = 'mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg';
                    messageDiv.textContent = message;
                    messageDiv.classList.remove('hidden');
                    
                    // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadPosts();
                    
                    // 3ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                    setTimeout(() => {
                        messageDiv.classList.add('hidden');
                    }, 3000);
                    
                } catch (error) {
                    console.error('ë³µì› ì‹¤íŒ¨:', error);
                    const messageDiv = document.getElementById('import-message');
                    messageDiv.className = 'mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                    messageDiv.textContent = 'âŒ ë³µì› ì‹¤íŒ¨: ' + error.message;
                    messageDiv.classList.remove('hidden');
                }
                
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                event.target.value = '';
            };
            
            reader.onerror = function() {
                alert('âŒ íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ ê´€ë ¨ ë³€ìˆ˜
        let editQuill = null;
        let editTags = [];
        let editImages = [];
        
        // ê²Œì‹œê¸€ ìˆ˜ì •
        function editPost(id) {
            const posts = getAllPosts();
            const post = posts.find(p => p.id === id);
            
            if (!post) {
                alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ë³¸ ì •ë³´ ì„¤ì •
            document.getElementById('edit-post-id').value = post.id;
            document.getElementById('edit-title').value = post.title;
            document.getElementById('edit-excerpt').value = post.excerpt || '';
            document.getElementById('edit-stockName').value = post.stockName || '';
            document.getElementById('edit-stockSymbol').value = post.stockSymbol || '';
            document.getElementById('edit-author').value = post.author || 'investa';
            
            // íƒœê·¸ ì„¤ì •
            editTags = [...(post.tags || [])];
            renderEditTags();
            
            // ì´ë¯¸ì§€ ì„¤ì •
            editImages = [...(post.images || [])];
            renderEditImages();
            
            // Quill ì—ë””í„° ì´ˆê¸°í™”
            initEditQuill(post.content);
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modal = document.getElementById('edit-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        // Quill ì—ë””í„° ì´ˆê¸°í™”
        function initEditQuill(initialContent) {
            const contentEditor = document.getElementById('edit-contentEditor');
            const contentTextarea = document.getElementById('edit-content');
            
            // ê¸°ì¡´ ì—ë””í„°ê°€ ìˆìœ¼ë©´ ì œê±°
            if (editQuill) {
                editQuill = null;
            }
            
            // ì—ë””í„° ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            contentEditor.innerHTML = '';
            
            // Quill ì—ë””í„° ìƒì„±
            if (typeof Quill !== 'undefined') {
                editQuill = new Quill('#edit-contentEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: {
                            container: [
                                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                                ['bold', 'italic', 'underline', 'strike'],
                                [{ 'color': [] }, { 'background': [] }],
                                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                [{ 'align': [] }],
                                ['link', 'image'],
                                ['blockquote', 'code-block'],
                                ['clean']
                            ],
                            handlers: {
                                'image': function() {
                                    const input = document.createElement('input');
                                    input.setAttribute('type', 'file');
                                    input.setAttribute('accept', 'image/*');
                                    input.click();
                                    
                                    input.onchange = () => {
                                        const file = input.files[0];
                                        if (file) {
                                            if (file.size > 5 * 1024 * 1024) {
                                                alert('ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                                                return;
                                            }
                                            
                                            const reader = new FileReader();
                                            reader.onload = (e) => {
                                                const range = editQuill.getSelection(true);
                                                editQuill.insertEmbed(range.index, 'image', e.target.result);
                                                editQuill.setSelection(range.index + 1);
                                            };
                                            reader.readAsDataURL(file);
                                        }
                                    };
                                }
                            }
                        }
                    },
                    placeholder: 'ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...'
                });
                
                // ì´ˆê¸° ë‚´ìš© ì„¤ì •
                if (initialContent) {
                    editQuill.root.innerHTML = initialContent;
                    contentTextarea.value = initialContent;
                }
                
                // ì—ë””í„° ë‚´ìš© ë³€ê²½ ì‹œ textareaì— ì €ì¥
                editQuill.on('text-change', () => {
                    const html = editQuill.root.innerHTML;
                    contentTextarea.value = html;
                });
            } else {
                // Quillì´ ì—†ìœ¼ë©´ ì¼ë°˜ textarea ì‚¬ìš©
                contentTextarea.classList.remove('hidden');
                contentTextarea.rows = 20;
                contentTextarea.value = initialContent || '';
            }
        }
        
        // íƒœê·¸ ë Œë”ë§
        function renderEditTags() {
            const container = document.getElementById('edit-tagsContainer');
            container.innerHTML = editTags.map(tag => `
                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm flex items-center gap-2">
                    #${escapeHtml(tag)}
                    <button type="button" onclick="removeEditTag('${escapeHtml(tag)}')" class="text-blue-700 hover:text-blue-900">Ã—</button>
                </span>
            `).join('');
        }
        
        // íƒœê·¸ ì¶”ê°€
        function addEditTag() {
            const tagInput = document.getElementById('edit-tagInput');
            const tag = tagInput.value.trim();
            
            if (tag && !editTags.includes(tag)) {
                editTags.push(tag);
                tagInput.value = '';
                renderEditTags();
            }
        }
        
        // íƒœê·¸ ì œê±°
        function removeEditTag(tag) {
            editTags = editTags.filter(t => t !== tag);
            renderEditTags();
        }
        
        // ì´ë¯¸ì§€ ë Œë”ë§
        function renderEditImages() {
            const container = document.getElementById('edit-imagesContainer');
            if (editImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = editImages.map((image, idx) => `
                <div class="relative group">
                    <img src="${escapeHtml(image)}" alt="ì´ë¯¸ì§€ ${idx + 1}" class="w-full h-32 object-cover rounded-lg border border-gray-300">
                    <button type="button" onclick="removeEditImage('${escapeHtml(image)}')" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">Ã—</button>
                </div>
            `).join('');
        }
        
        // ì´ë¯¸ì§€ ì¶”ê°€
        function addEditImage() {
            const imageInput = document.getElementById('edit-imageInput');
            const imageUrl = imageInput.value.trim();
            
            if (imageUrl && !editImages.includes(imageUrl)) {
                editImages.push(imageUrl);
                imageInput.value = '';
                renderEditImages();
            }
        }
        
        // ì´ë¯¸ì§€ ì œê±°
        function removeEditImage(image) {
            editImages = editImages.filter(img => img !== image);
            renderEditImages();
        }
        
        function closeEditModal() {
            const modal = document.getElementById('edit-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // ì—ë””í„° ì •ë¦¬
            if (editQuill) {
                editQuill = null;
            }
            editTags = [];
            editImages = [];
        }
        
        function saveEditedPost(event) {
            event.preventDefault();
            
            const id = document.getElementById('edit-post-id').value;
            const title = document.getElementById('edit-title').value;
            const excerpt = document.getElementById('edit-excerpt').value;
            const stockName = document.getElementById('edit-stockName').value || undefined;
            const stockSymbol = document.getElementById('edit-stockSymbol').value || undefined;
            const author = document.getElementById('edit-author').value || 'investa';
            
            // Quill ì—ë””í„°ì—ì„œ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            let content = '';
            if (editQuill) {
                content = editQuill.root.innerHTML;
            } else {
                content = document.getElementById('edit-content').value;
            }
            
            if (!content.trim()) {
                alert('ë³¸ë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const posts = getAllPosts();
            const post = posts.find(p => p.id === id);
            
            if (!post) {
                alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê²Œì‹œê¸€ ì—…ë°ì´íŠ¸
            post.title = title;
            post.excerpt = excerpt;
            post.content = content;
            post.tags = [...editTags];
            post.images = [...editImages];
            post.stockName = stockName;
            post.stockSymbol = stockSymbol;
            post.author = author;
            post.updatedAt = new Date().toISOString();
            
            if (savePost(post)) {
                alert('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeEditModal();
                loadPosts();
            } else {
                alert('ê²Œì‹œê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²Œì‹œê¸€ ì‚­ì œ
        function confirmDelete(id, title) {
            if (confirm(`"${title}" ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                if (deletePost(id)) {
                    alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadPosts();
                    
                    // í†µê³„ë„ ì‚­ì œ
                    const stats = getStats();
                    delete stats.views[id];
                    saveStats(stats);
                } else {
                    alert('ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // í†µê³„ ë¡œë“œ
        function loadStats() {
            const stats = getStats();
            
            // ì¼ìë³„ ë°©ë¬¸ì ì°¨íŠ¸
            loadVisitorChart(stats.visitors);
            
            // ê²Œì‹œê¸€ë³„ ì¡°íšŒìˆ˜ ì°¨íŠ¸
            loadViewsChart(stats.views);
        }
        
        function loadVisitorChart(visitors) {
            const ctx = document.getElementById('visitorChart');
            
            // ìµœê·¼ 7ì¼ ë°ì´í„° ì •ë ¬
            const dates = Object.keys(visitors).sort().slice(-7);
            const values = dates.map(date => visitors[date] || 0);
            
            // ë‚ ì§œ í¬ë§·íŒ…
            const formattedDates = dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });
            
            if (window.visitorChart) {
                window.visitorChart.destroy();
            }
            
            window.visitorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: formattedDates,
                    datasets: [{
                        label: 'ë°©ë¬¸ì ìˆ˜',
                        data: values,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        function loadViewsChart(views) {
            const ctx = document.getElementById('viewsChart');
            
            const posts = getAllPosts();
            
            // ì¡°íšŒìˆ˜ê°€ ìˆëŠ” ê²Œì‹œê¸€ë§Œ í•„í„°ë§
            const postsWithViews = posts
                .map(post => ({
                    title: post.title.length > 20 ? post.title.substring(0, 20) + '...' : post.title,
                    views: views[post.id] || 0
                }))
                .filter(item => item.views > 0)
                .sort((a, b) => b.views - a.views)
                .slice(0, 10); // ìƒìœ„ 10ê°œë§Œ í‘œì‹œ
            
            if (postsWithViews.length === 0) {
                ctx.parentElement.innerHTML = `
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">ê²Œì‹œê¸€ë³„ ì¡°íšŒìˆ˜</h2>
                    <p class="text-gray-500 text-center py-8">ì¡°íšŒìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                `;
                return;
            }
            
            const labels = postsWithViews.map(item => item.title);
            const data = postsWithViews.map(item => item.views);
            
            if (window.viewsChart) {
                window.viewsChart.destroy();
            }
            
            window.viewsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì¡°íšŒìˆ˜',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ê¸€ì“°ê¸° í˜ì´ì§€ë¡œ ì´ë™
        function goToWritePage() {
            try {
                // í˜„ì¬ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ê¸°ì¤€ìœ¼ë¡œ index.html ì°¾ê¸°
                let indexPath;
                
                if (window.location.protocol === 'file:') {
                    // ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì¸ ê²½ìš°
                    const currentPath = window.location.pathname;
                    const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
                    indexPath = currentDir + 'index.html';
                } else {
                    // ì›¹ ì„œë²„ì¸ ê²½ìš°
                    const currentPath = window.location.pathname;
                    if (currentPath.includes('admin.html')) {
                        indexPath = currentPath.replace('admin.html', 'index.html');
                    } else {
                        const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
                        indexPath = currentDir + 'index.html';
                    }
                }
                
                // í•´ì‹œì™€ í•¨ê»˜ ì´ë™
                window.location.href = indexPath + '#/write3';
            } catch (error) {
                console.error('Error navigating to write page:', error);
                alert('ê¸€ì“°ê¸° í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. index.html íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();
            recordVisitor(); // í˜ì´ì§€ ë°©ë¬¸ ê¸°ë¡
            
            // ìˆ˜ì • ëª¨ë‹¬ íƒœê·¸ ì…ë ¥ ì´ë²¤íŠ¸
            const editTagInput = document.getElementById('edit-tagInput');
            const editAddTagBtn = document.getElementById('edit-addTagBtn');
            if (editTagInput) {
                editTagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addEditTag();
                    }
                });
            }
            if (editAddTagBtn) {
                editAddTagBtn.addEventListener('click', addEditTag);
            }
            
            // ìˆ˜ì • ëª¨ë‹¬ ì´ë¯¸ì§€ ì…ë ¥ ì´ë²¤íŠ¸
            const editImageInput = document.getElementById('edit-imageInput');
            const editAddImageBtn = document.getElementById('edit-addImageBtn');
            if (editImageInput) {
                editImageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addEditImage();
                    }
                });
            }
            if (editAddImageBtn) {
                editAddImageBtn.addEventListener('click', addEditImage);
            }
        });
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•¨ìˆ˜
        const ADMIN_PASSWORD = 'lucky';
        const AUTH_KEY = 'admin_authenticated';

        function checkPassword(event) {
            event.preventDefault();
            const passwordInput = document.getElementById('password-input');
            const password = passwordInput.value;
            const errorDiv = document.getElementById('password-error');
            const passwordModal = document.getElementById('password-modal');
            const mainContent = document.getElementById('main-content');

            if (password === ADMIN_PASSWORD) {
                // ë¹„ë°€ë²ˆí˜¸ê°€ ë§ìœ¼ë©´ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì¸ì¦ ìƒíƒœ ì €ì¥
                sessionStorage.setItem(AUTH_KEY, 'true');
                passwordModal.classList.add('hidden');
                mainContent.classList.remove('hidden');
            } else {
                // ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦¬ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                errorDiv.classList.remove('hidden');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = sessionStorage.getItem(AUTH_KEY) === 'true';
            const passwordModal = document.getElementById('password-modal');
            const mainContent = document.getElementById('main-content');

            if (isAuthenticated) {
                // ì´ë¯¸ ì¸ì¦ëœ ê²½ìš° ëª¨ë‹¬ ìˆ¨ê¸°ê³  ì»¨í…ì¸  í‘œì‹œ
                passwordModal.classList.add('hidden');
                mainContent.classList.remove('hidden');
            } else {
                // ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ëª¨ë‹¬ í‘œì‹œí•˜ê³  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                passwordModal.classList.remove('hidden');
                mainContent.classList.add('hidden');
            }

            // Enter í‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ê°€ëŠ¥
            const passwordInput = document.getElementById('password-input');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const form = document.getElementById('password-form');
                        if (form) {
                            form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

